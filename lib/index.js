"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");require("core-js/modules/es.symbol"),require("core-js/modules/es.symbol.description"),require("core-js/modules/es.array.for-each"),require("core-js/modules/es.array.iterator"),require("core-js/modules/es.object.create"),require("core-js/modules/es.object.to-string"),require("core-js/modules/es.reflect.delete-property"),require("core-js/modules/es.reflect.get"),require("core-js/modules/es.reflect.has"),require("core-js/modules/es.reflect.own-keys"),require("core-js/modules/es.reflect.set"),require("core-js/modules/es.set"),require("core-js/modules/es.string.iterator"),require("core-js/modules/web.dom-collections.for-each"),require("core-js/modules/web.dom-collections.iterator"),Object.defineProperty(exports,"__esModule",{value:!0}),exports.mazzard=mazzard,exports.observer=observer,exports.action=action,exports.observe=observe,exports.setActiveReaction=setActiveReaction,exports.getActiveReaction=getActiveReaction,exports.setActiveReactions=setActiveReactions,exports.getActiveReactions=getActiveReactions,exports.defaultPlugin=defaultPlugin,exports.MAZZARD=exports.Mazzard=exports["default"]=void 0;var activeReaction,activeReactions,_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_typeof2=_interopRequireDefault(require("@babel/runtime/helpers/typeof")),MAZZARD=Symbol("Mazzard instance");exports.MAZZARD=MAZZARD;function setActiveReaction(a){activeReaction=a}function getActiveReaction(){return activeReaction}function setActiveReactions(a){activeReactions=a}function getActiveReactions(){return activeReactions}function observer(a){var b=function reaction(){if(b){var d=activeReaction;activeReaction=b,a(c),activeReaction=d}},c=function(){return b=void 0};return b(c),c}function action(a){return function(){if(activeReactions)return a.apply(this,arguments);var b=activeReactions=new Set,c=a.apply(this,arguments);return activeReactions=void 0,b.forEach(function(a){return a()}),c}}function observe(a,b){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Object.create(null),d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:Object.create(null),e=4<arguments.length&&arguments[4]!==void 0?arguments[4]:Object.create(null),f=5<arguments.length&&arguments[5]!==void 0?arguments[5]:Object.create(null),g=6<arguments.length&&arguments[6]!==void 0?arguments[6]:Object.create(null);"reactions"in g||(g.reactions=new Set);var h={};return new Proxy(a,{get:function get(a,i,j){return!(i!==MAZZARD)||(i in Object.prototype?Reflect.get(a,i,j):(activeReaction&&(!(i in d)&&(d[i]=new Set),!(i in e)&&(e[i]=new Set),d[i].add(activeReaction),e[i].add(activeReaction)),i in c)?c[i]:(observer(function(){var k=i in h?h[i]:Reflect.get(a,i,j);if(null!==k){var n=(0,_typeof2["default"])(k);"object"===n?k.constructor&&k.constructor!==Object?b&&(k=b(k,c,d,e,f,g)):!k[MAZZARD]&&(k=observe(k,b)):"function"===n&&(k=action(k))}if(!(i in c))c[i]=k;else if(c[i]!==k){c[i]=k;var o=e[i];if(o){var l=f[i],m=d[i];delete e[i],activeReactions?o.forEach(function(a){l&&l["delete"](a),m["delete"](a),activeReactions.add(a)}):o.forEach(function(a){l&&l["delete"](a),m["delete"](a),a()})}}}),c[i]))},set:function set(a,i,j,k){var l=activeReactions;activeReactions=new Set;var m=!Reflect.has(a,i);Reflect.set(a,i,j,k);var n=h[i]=a[i];if(c[i]!==n){if(null!==n){var q=(0,_typeof2["default"])(n);"object"===q?n.constructor&&n.constructor!==Object?b&&(n=b(n,c,d,e,f,g)):!n[MAZZARD]&&(n=observe(n,b)):"function"===q&&(n=action(n))}c[i]=n;var r=d[i];if(r){var o=f[i],p=e[i];d[i]=new Set,r.forEach(function(a){p&&(p["delete"](a),g.reactions["delete"](a),o&&o["delete"](a),activeReactions.add(a)),o&&m?(o["delete"](a),activeReactions.add(a)):d[i].add(a)})}else if(m&&g.value&&g.reactions.size){var s=g.reactions;g.reactions=new Set,delete g.value,s.forEach(function(a){return activeReactions.add(a)})}}else if(m&&g.value&&g.reactions.size){var t=g.reactions;g.reactions=new Set,delete g.value,t.forEach(function(a){return activeReactions.add(a)})}if(l)activeReactions.forEach(function(a){return l.add(a)}),activeReactions=l;else{var u=activeReactions;activeReactions=l,u.forEach(function(a){return a()})}return!0},has:function has(a,b){return!(b!==MAZZARD)||(activeReaction&&(!(b in f)&&(f[b]=new Set),!(b in d)&&(d[b]=new Set),f[b].add(activeReaction),d[b].add(activeReaction)),Reflect.has(a,b))},deleteProperty:function deleteProperty(a,b){if(Reflect.has(a,b))if(Reflect.deleteProperty(a,b),b in d){var h=d[b],i=f[b],j=e[b],k=void 0!==c[b];delete d[b],activeReactions?h.forEach(function(a){i?(i["delete"](a),j["delete"](a),c[b]=void 0,activeReactions.add(a)):j&&k&&(j["delete"](a),c[b]=void 0,activeReactions.add(a))}):h.forEach(function(a){i?(i["delete"](a),j&&(j["delete"](a),c[b]=void 0),a()):j&&k&&(j["delete"](a),c[b]=void 0,a())})}else if(g.value&&g.reactions.size){var l=g.reactions;g.reactions=new Set,delete g.value,activeReactions?l.forEach(function(a){return activeReactions.add(a)}):l.forEach(function(a){return a()})}return!0},ownKeys:function ownKeys(a){return activeReaction&&g.reactions.add(activeReaction),g.value?g.value:g.value=Reflect.ownKeys(a)}})}function defaultPlugin(a){return a instanceof Array&&!a[MAZZARD]?observe(a,defaultPlugin):a}function mazzard(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:defaultPlugin;if(null===a)return a;var c=(0,_typeof2["default"])(a);return"object"===c?a.constructor&&a.constructor!==Object?b?b(a):a:a[MAZZARD]?a:observe(a,b):"function"===c?observer(a):a}var Mazzard=function a(b){return(0,_classCallCheck2["default"])(this,a),observe(this,b||defaultPlugin)};exports.Mazzard=Mazzard;var _default=mazzard;exports["default"]=_default;